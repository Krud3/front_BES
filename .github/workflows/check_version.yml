name: Check Version Bump

on:
  pull_request:
    branches:
      - main
  workflow_dispatch:

jobs:
  check-version:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Check if version changed
        run: |
          BASE_VERSION=$(git show origin/main:package.json | jq -r .version)
          
          HEAD_VERSION=$(jq -r .version package.json)
          
          echo "üîπ Versi√≥n en Main: $BASE_VERSION"
          echo "üî∏ Versi√≥n en tu PR: $HEAD_VERSION"
          
          if [ "$BASE_VERSION" == "$HEAD_VERSION" ]; then
            echo "‚ùå ERROR: No has actualizado la versi√≥n en package.json."
            echo "üí° Por favor, incrementa la versi√≥n antes de hacer merge."
            exit 1 # Esto hace fallar la acci√≥n y bloquea el PR
          fi
          
          echo "‚úÖ ¬°Excelente! La versi√≥n ha cambiado."